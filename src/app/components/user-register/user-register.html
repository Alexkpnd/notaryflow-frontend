<div class="container mt-5">
    <h4 class="text-primary">Εγγραφή νέου χρήστη</h4>
    <h6 class="lead text-secondary">Παρακαλώ εγγραφείτε για είσοδο στις υπηρεσίες.</h6>
    @if (registrationStatus()) {
        @if (registrationStatus()?.success){
            <div class="alert alert-success mt-2 w-50">
                {{registrationStatus()?.message}}
            </div>
        }
        @if (!registrationStatus()?.success) {
            <div class="alert alert-danger mt-2 w-60">
                <p>Error: {{registrationStatus()?.message}}</p>

            </div>
        }
    }
    <form class="d-flex flex-column align-items-center mt-4 gap-2" [formGroup]="registerForm">
        <div class="d-flex gap-2">
            <div class=" d-flex flex-column">
                <div class="p-4 border rounded">
                    <h6 class="text-secondary mb-3">Απαραίτητα στοιχεία</h6>
                    <div class="d-flex gap-3 mb-5">
                        <mat-form-field appearance="outline" >
                            <mat-label>Email</mat-label>
                            <input type="text", matInput formControlName="email">
                            <mat-error>Το email είναι υποχρεωτικό.</mat-error>
                        </mat-form-field>
                        <mat-form-field appearance="outline">
                            <mat-label>Ψευδώνυμο</mat-label>
                            <input type="text", matInput formControlName="username">
                            @if (registerForm.get('username')?.hasError('minlength')) {
                                <mat-error>Το Ψευδώνυμο πρέπει να ειναι τουλάχιστον 3 χαρακτήρες</mat-error>
                            } @else {
                                <mat-error>Το Ψευδώνυμο ειναι υποχρεωτικό</mat-error>
                            }                          
                        </mat-form-field>
                    </div>
                    <div class="d-flex gap-3 mb-5">
                        <mat-form-field appearance="outline">
                            <mat-label>Κωδικός</mat-label>
                            <input type="password", matInput formControlName="password">
                            @if (registerForm.get('password')?.touched && registerForm.get("password")?.hasError("required")) {
                                <mat-error>Ο Κωδικός ειναι υποχρεωτικός</mat-error>
                            } @else if (registerForm.get('password')?.touched && registerForm.get("password")?.hasError("pattern")) {
                                <mat-error>Ελάχιστες απαιτήσεις: 8 χαραρκτήρες, 1 Κεφαλαίο, 1 πεζό, 1 αριθμός και 1 ειδικός χαρακτήρας κατ' ελάχιστο. </mat-error>
                            }
                        </mat-form-field>
                        <mat-form-field appearance="outline">
                            <mat-label>Επιβεβαίωση Κωδικού</mat-label>
                            <input type="password", matInput formControlName="confirmPassword">
                            @if (registerForm.get('confirmPassword')?.hasError('passwordMissmatch')) {
                                <mat-error>Οι κωδικοί δεν ταιριάζουν.</mat-error>
                            } @else if (registerForm.get('confirmPassword')?.touched && registerForm.get("confirmPassword")?.invalid) {
                                <mat-error> Ο κωδικός λείπει ή ειναι λάθος</mat-error>
                            }
                        </mat-form-field>
                    </div>
                </div>
                <div class="p-4 mt-2 border rounded">
                    <h6 class="text-secondary mb-3">Προσωπικά στοιχεία</h6>
                    <div class="d-flex gap-3 mb-3">
                        <mat-form-field appearance="outline">
                            <mat-label> Όνομα </mat-label>
                            <input type="text" matInput formControlName="firstname">
                        </mat-form-field>

                        <mat-form-field appearance="outline">
                            <mat-label>Επώνυμο</mat-label>
                            <input type="text" matInput formControlName="lastname">
                        </mat-form-field>
                    </div>                   
                </div>
            </div>
            <div class="d-flex flex-column p-4 border rounded" formGroupName="address">
                <h6 class="text-secondary mb-3">Στοιχεία διέυθυνσης</h6>
                <div class="d-flex gap-3">
                    <mat-form-field appearance="outline">
                        <mat-label>Οδός</mat-label>
                        <input type="text" matInput formControlName="street">
                    </mat-form-field>
                    <mat-form-field appearance="outline">
                        <mat-label>Αριθμός</mat-label>
                        <input type="text" matInput formControlName="streetNum">
                    </mat-form-field>
                </div>
                <div class="d-flex gap-3">
                    <mat-form-field appearance="outline">
                        <mat-label>Τ.Κ.</mat-label>
                        <input type="text" matInput formControlName="postCode">
                    </mat-form-field>
                    <mat-form-field appearance="outline">
                        <mat-label>Πόλη</mat-label>
                        <input type="text" matInput formControlName="city">
                    </mat-form-field>
                </div>
                <mat-form-field appearance="outline">
                    <mat-label>Χώρα</mat-label>
                    <input type="text" matInput formControlName="country">
                </mat-form-field>
            </div>
        </div>
        <div class=" p-4 border rounded">
            <h6 class="text-secondary mb-3">Στοιχεία επικοινωνίας</h6>
            <div formArrayName="phone"> 
                @for (p of phone.controls; let i=$index; track i ) {
                    <div [formGroupName]="i" class="d-flex gap-3">
                        <mat-form-field appearance="outline">
                            <mat-label> Τύπος</mat-label>
                            <mat-select formControlName="type">
                                <mat-option value="mobile">Κινητό</mat-option>
                                <mat-option value="work">Εργασία</mat-option>
                                <mat-option value="home">Οικία</mat-option>
                            </mat-select>
                        </mat-form-field>
                        <mat-form-field appearance="outline">
                            <mat-label>Αριθμός</mat-label>
                            <input type="text" matInput formControlName="phoneNum">
                        </mat-form-field>
                        @if (phone.controls.length > 1 && i!== 0) {
                            <span role="button" class="cursor-pointer pt-3" (click)="deletePhoneNumber(i)"><i class="bi bi-x-circle fs-4"></i></span>
                        }
                        <span role="button" class="cursor-pointer pt-3" (click)="addPhoneNumber()"><i class="bi bi-plus-circle fs-4"></i></span>
                    </div>
                }
            </div>      
        </div>
        <div class="d-flex gap-3">
            <button mat-raised-button type="button" (click)="onResetValues()">Καθαρισμός φόρμας</button>
            <button mat-flat-button color="primary" type="button" (click)="onSubmit()" [disabled]="registerForm.invalid">Εγγραφή</button>
        </div>
        
    </form>
</div>